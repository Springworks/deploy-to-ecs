"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const boom_1 = require("boom");
const internals_1 = require("./internals");
function useParamsOrDefaults(params) {
    return params || {};
}
function createError(params) {
    const { code, message, cause, root_error_id, stack_from } = useParamsOrDefaults(params);
    const error = new Error(message !== null ? message : undefined);
    Error.captureStackTrace(error, stack_from || createError);
    const error_code = internals_1.getStatusCode(code, cause);
    boom_1.boomify(error, { statusCode: error_code });
    error.code = error_code;
    const error_id = internals_1.generateId();
    error.error_id = error_id;
    error.output.payload.error_id = error_id;
    const root_id = internals_1.getRootErrorId(root_error_id, cause) || error_id;
    error.root_error_id = root_id;
    error.output.payload.root_error_id = root_id;
    error.cause = cause;
    if (cause && internals_1.isJoi(cause)) {
        error.name = cause.name;
        error.details = cause.details;
        error._object = cause._object;
        error.annotate = cause.annotate;
        error.output.payload.details = cause.details;
    }
    if (cause && cause.output && cause.output.headers) {
        error.output.headers = cause.output.headers;
    }
    if (process.env.NODE_ENV === 'test') {
        error.toString = internals_1.toStringDebug;
    }
    return error;
}
exports.createError = createError;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwrQkFBdUM7QUFDdkMsMkNBQThGO0FBNEI5RixTQUFTLG1CQUFtQixDQUFDLE1BQTBCO0lBQ3JELE9BQU8sTUFBTSxJQUFJLEVBQUUsQ0FBQztBQUN0QixDQUFDO0FBRUQsU0FBZ0IsV0FBVyxDQUFDLE1BQTBCO0lBQ3BELE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLEdBQUcsbUJBQW1CLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFeEYsTUFBTSxLQUFLLEdBQVEsSUFBSSxLQUFLLENBQUMsT0FBTyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNyRSxLQUFLLENBQUMsaUJBQWlCLENBQUMsS0FBSyxFQUFFLFVBQVUsSUFBSSxXQUFXLENBQUMsQ0FBQztJQUUxRCxNQUFNLFVBQVUsR0FBRyx5QkFBYSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztJQUM5QyxjQUFPLENBQUMsS0FBSyxFQUFFLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7SUFDM0MsS0FBSyxDQUFDLElBQUksR0FBRyxVQUFVLENBQUM7SUFFeEIsTUFBTSxRQUFRLEdBQUcsc0JBQVUsRUFBRSxDQUFDO0lBQzlCLEtBQUssQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQzFCLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7SUFFekMsTUFBTSxPQUFPLEdBQUcsMEJBQWMsQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLElBQUksUUFBUSxDQUFDO0lBQ2pFLEtBQUssQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDO0lBQzlCLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsR0FBRyxPQUFPLENBQUM7SUFFN0MsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFFcEIsSUFBSSxLQUFLLElBQUksaUJBQUssQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUN6QixLQUFLLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDeEIsS0FBSyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQzlCLEtBQUssQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQztRQUM5QixLQUFLLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7UUFFaEMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUM7S0FDOUM7SUFFRCxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFO1FBQ2pELEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO0tBQzdDO0lBRUQsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxNQUFNLEVBQUU7UUFDbkMsS0FBSyxDQUFDLFFBQVEsR0FBRyx5QkFBYSxDQUFDO0tBQ2hDO0lBRUQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBdENELGtDQXNDQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGJvb21pZnksIE91dHB1dCB9IGZyb20gJ2Jvb20nO1xuaW1wb3J0IHsgZ2VuZXJhdGVJZCwgZ2V0Um9vdEVycm9ySWQsIGdldFN0YXR1c0NvZGUsIGlzSm9pLCB0b1N0cmluZ0RlYnVnIH0gZnJvbSAnLi9pbnRlcm5hbHMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRpb25EZXRhaWwge1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIHBhdGg6IHN0cmluZztcbiAgdHlwZTogc3RyaW5nO1xuICBjb250ZXh0OiB7IFtrZXk6IHN0cmluZ106IGFueSB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZlbEVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb2RlOiBudW1iZXI7XG4gIGNhdXNlPzogRXJyb3I7XG4gIGlzQm9vbTogdHJ1ZTtcbiAgaXNTZXJ2ZXI6IGJvb2xlYW47XG4gIGVycm9yX2lkOiBzdHJpbmc7XG4gIHJvb3RfZXJyb3JfaWQ6IHN0cmluZztcbiAgb3V0cHV0PzogT3V0cHV0O1xuICBkZXRhaWxzPzogQXJyYXk8VmFsaWRhdGlvbkRldGFpbD47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlRXJyb3JQYXJhbXMge1xuICBjb2RlPzogbnVtYmVyO1xuICBtZXNzYWdlPzogc3RyaW5nO1xuICBjYXVzZT86IGFueTtcbiAgcm9vdF9lcnJvcl9pZD86IHN0cmluZztcbiAgc3RhY2tfZnJvbT86IEZ1bmN0aW9uO1xufVxuXG5mdW5jdGlvbiB1c2VQYXJhbXNPckRlZmF1bHRzKHBhcmFtcz86IENyZWF0ZUVycm9yUGFyYW1zKTogQ3JlYXRlRXJyb3JQYXJhbXMge1xuICByZXR1cm4gcGFyYW1zIHx8IHt9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRXJyb3IocGFyYW1zPzogQ3JlYXRlRXJyb3JQYXJhbXMpOiBGZWxFcnJvciB7XG4gIGNvbnN0IHsgY29kZSwgbWVzc2FnZSwgY2F1c2UsIHJvb3RfZXJyb3JfaWQsIHN0YWNrX2Zyb20gfSA9IHVzZVBhcmFtc09yRGVmYXVsdHMocGFyYW1zKTtcblxuICBjb25zdCBlcnJvcjogYW55ID0gbmV3IEVycm9yKG1lc3NhZ2UgIT09IG51bGwgPyBtZXNzYWdlIDogdW5kZWZpbmVkKTtcbiAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UoZXJyb3IsIHN0YWNrX2Zyb20gfHwgY3JlYXRlRXJyb3IpO1xuXG4gIGNvbnN0IGVycm9yX2NvZGUgPSBnZXRTdGF0dXNDb2RlKGNvZGUsIGNhdXNlKTtcbiAgYm9vbWlmeShlcnJvciwgeyBzdGF0dXNDb2RlOiBlcnJvcl9jb2RlIH0pO1xuICBlcnJvci5jb2RlID0gZXJyb3JfY29kZTtcblxuICBjb25zdCBlcnJvcl9pZCA9IGdlbmVyYXRlSWQoKTtcbiAgZXJyb3IuZXJyb3JfaWQgPSBlcnJvcl9pZDtcbiAgZXJyb3Iub3V0cHV0LnBheWxvYWQuZXJyb3JfaWQgPSBlcnJvcl9pZDtcblxuICBjb25zdCByb290X2lkID0gZ2V0Um9vdEVycm9ySWQocm9vdF9lcnJvcl9pZCwgY2F1c2UpIHx8IGVycm9yX2lkO1xuICBlcnJvci5yb290X2Vycm9yX2lkID0gcm9vdF9pZDtcbiAgZXJyb3Iub3V0cHV0LnBheWxvYWQucm9vdF9lcnJvcl9pZCA9IHJvb3RfaWQ7XG5cbiAgZXJyb3IuY2F1c2UgPSBjYXVzZTtcblxuICBpZiAoY2F1c2UgJiYgaXNKb2koY2F1c2UpKSB7XG4gICAgZXJyb3IubmFtZSA9IGNhdXNlLm5hbWU7XG4gICAgZXJyb3IuZGV0YWlscyA9IGNhdXNlLmRldGFpbHM7XG4gICAgZXJyb3IuX29iamVjdCA9IGNhdXNlLl9vYmplY3Q7XG4gICAgZXJyb3IuYW5ub3RhdGUgPSBjYXVzZS5hbm5vdGF0ZTtcblxuICAgIGVycm9yLm91dHB1dC5wYXlsb2FkLmRldGFpbHMgPSBjYXVzZS5kZXRhaWxzO1xuICB9XG5cbiAgaWYgKGNhdXNlICYmIGNhdXNlLm91dHB1dCAmJiBjYXVzZS5vdXRwdXQuaGVhZGVycykge1xuICAgIGVycm9yLm91dHB1dC5oZWFkZXJzID0gY2F1c2Uub3V0cHV0LmhlYWRlcnM7XG4gIH1cblxuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0Jykge1xuICAgIGVycm9yLnRvU3RyaW5nID0gdG9TdHJpbmdEZWJ1ZztcbiAgfVxuXG4gIHJldHVybiBlcnJvcjtcbn1cbiJdfQ==