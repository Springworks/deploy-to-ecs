'use strict';

var _require = require('@slack/client'),
    IncomingWebhook = _require.IncomingWebhook;

var internals = {};

exports.create = function (webhook_url, username, channel) {
  var slack_instance = new IncomingWebhook(webhook_url);
  return {
    sendDeploymentMessage: internals.sendDeploymentMessage.bind(null, { slack_instance: slack_instance, username: username, channel: channel })
  };
};

internals.sendDeploymentMessage = function (_ref, message, opt_attachments) {
  var slack_instance = _ref.slack_instance,
      username = _ref.username,
      channel = _ref.channel;

  var send_options = {
    text: message,
    channel: channel,
    username: username,
    icon_emoji: ':shipit:'
  };
  if (Array.isArray(opt_attachments)) {
    send_options.attachments = opt_attachments;
  }
  return slack_instance.send(send_options);
};

/* istanbul ignore else */
if (process.env.NODE_ENV === 'test') {
  exports.internals = internals;
}