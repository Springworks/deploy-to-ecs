'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createError = createError;

var _boom = require('boom');

var _internals = require('./internals');

function createError() {
  var _ref = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];

  let code = _ref.code;
  let message = _ref.message;
  let cause = _ref.cause;
  let root_error_id = _ref.root_error_id;
  let stack_from = _ref.stack_from;

  const error = new Error(message !== null ? message : undefined);
  Error.captureStackTrace(error, stack_from || createError);

  const error_code = (0, _internals.getStatusCode)(code, cause);
  (0, _boom.wrap)(error, error_code);
  error.code = error_code;

  const error_id = (0, _internals.generateId)();
  error.error_id = error_id;
  error.output.payload.error_id = error_id;

  const root_id = (0, _internals.getRootErrorId)(root_error_id, cause) || error_id;
  error.root_error_id = root_id;
  error.output.payload.root_error_id = root_id;

  error.cause = cause;

  if ((0, _internals.isJoi)(cause)) {
    error.name = cause.name;
    error.details = cause.details;
    error._object = cause._object;
    error.annotate = cause.annotate;

    error.output.payload.details = cause.details;
  }

  if (cause && cause.output && cause.output.headers) {
    error.output.headers = cause.output.headers;
  }

  if (process.env.NODE_ENV === 'test') {
    error.toString = _internals.toStringDebug;
  }

  return error;
}